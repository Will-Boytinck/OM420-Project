SELECT till_receipt_number, IIF(SUM(IIF(sub_department in (1), sales_value, NULL))>0, 1 ,0) AS Grocery, IIF(SUM(IIF(sub_department in (3,33), sales_value, NULL))>0,1,0) AS Dairy, IIF(SUM(IIF(sub_department in (78,79), sales_value, NULL))>0,1 ,0) AS Tobacco, IIF(SUM(IIF(sub_department in (30,31,32,34,35), sales_value, NULL))>0, 1 ,0) AS Produce, IIF(SUM(IIF(sub_department in (20,21,22,23,24,25,26,27,28,29), sales_value, NULL))>0,1,0) AS Meat, IIF(SUM(IIF(sub_department in (50,51,61), sales_value, NULL))>0,1 ,0) AS Health, IIF(SUM(IIF(sub_department in (83,84,86,87,88,89,90,91,92,93,94,95,96,97,98), sales_value, NULL))>0, 1 ,0) AS Deli, IIF(SUM(IIF(sub_department in (60,62,63,67,68,69,70,71,72,74,76), sales_value, NULL))>0,1,0) AS GM, IIF(SUM(IIF(sub_department in (15,16,17), sales_value, NULL))>0,1,0) AS Floral, IIF(SUM(IIF(sub_department in (40,41,42,43,44,45), sales_value, NULL))>0, 1,0) AS Bakery, IIF(SUM(IIF(sub_department in (130,131), sales_value, NULL))>0,1,0) AS Water, IIF(SUM(IIF(sub_department in (80,81), sales_value, NULL))>0,1,0) AS Bulk_Foods, IIF(SUM(IIF(sub_department in (190,192,194), sales_value, NULL))>0, 1,0) AS Photo, IIF(SUM(IIF(sub_department in (4), sales_value, NULL))>0, 1,0) AS Frozen_food, IIF(SUM(IIF(sub_department in (73), sales_value, NULL))>0, 1,0) AS Pets, IIF(SUM(IIF(sub_department in (30), sales_value, NULL))>0,1,0) AS Produce_FruitDV
FROM transactionsT AS tr
GROUP BY till_receipt_number;
